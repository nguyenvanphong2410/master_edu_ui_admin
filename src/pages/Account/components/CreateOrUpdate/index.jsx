import React from 'react';
import { Button, Input, Radio, Skeleton, Space, Switch, Tooltip, TreeSelect } from 'antd';
import InlineSVG from 'react-inlinesvg';
import IconWarning from '../../../../assets/images/icons/light/warning.svg';
import Handle from './handle.js';
import HandlePermission from '@/pages/Permission/CreateOrUpdatePermission/handle';
import NoData from '@/pages/Permission/NoData';
import { hasPermission } from '@/utils/helper';
import { GENDER_USER, PERMISSIONS, TYPE_SUBMIT } from '@/utils/constants';
import avatarDefault from '@/assets/images/user/default-avatar-point.png';
import IconEditAvatar from '@/assets/images/icons/duotone/pencil.svg';
import Close from '@/assets/images/icons/duotone/xmark.svg';
import { setInForAdmin } from '@/states/modules/user';

export default function CreateOrUpdate(props) {
  const { isTypeModalCreate, closeModal } = props;
  const {
    inForAdmin,
    errorCreateOrUpdate,
    isLoadingBtnCreateOrUpdate,
    isLoadingDetailUser,
    configModalAdmin,
    dispatch,
    handleChangeInput,
    handleChangeSwitch,
    handleConfirm,
    handleFocus,
    handleChangeAvatar,
  } = Handle(props);
    console.log("üåà ~ CreateOrUpdate ~ inForAdmin:", inForAdmin)

  const { treeDataOption } = HandlePermission();

  return (
    <div>
      <div>
        <div className={`input-wrap`}>
          <div className={'label-wrap'}>·∫¢nh ƒë·∫°i di·ªán</div>
          <div className={`flex mb-4`}>
            <input
              id={'imageUpload'}
              type="file"
              accept="image/*"
              className={`hidden`}
              onChange={(file) => handleChangeAvatar(file)}
            />
            <Tooltip title="Ch·ªânh s·ª≠a ·∫£nh ƒë·∫°i di·ªán">
              <label className={`icon-img icon-edit-img`} htmlFor="imageUpload">
                <InlineSVG src={IconEditAvatar} alt="" className={`icon-action`} />
              </label>
            </Tooltip>
            <Tooltip title="X√≥a ·∫£nh ƒë·∫°i di·ªán">
              <div
                className={`icon-img icon-remove-img`}
                onClick={() => dispatch(setInForAdmin({ ...inForAdmin, avatarUrl: '', avatar: 'delete' }))}
              >
                <InlineSVG src={Close} alt="" className={`icon-action`} />
              </div>
            </Tooltip>
            <div className={`relative`}>
              <img
                src={inForAdmin.avatarUrl ? inForAdmin.avatarUrl : avatarDefault}
                crossOrigin="anonymous"
                alt=""
                className={`img-avt`}
              />
            </div>
          </div>
        </div>

        <div className="h-[300px] overflow-auto">
          <div className={`input-wrap`}>
            <div className={'label-wrap'}>
              H·ªç v√† t√™n <span className={'required'}>*</span>
            </div>
            {!isTypeModalCreate && isLoadingDetailUser ? (
              <Skeleton.Input size={'large'} active={true} block={true} />
            ) : (
              <Input
                className={`main-input`}
                placeholder={'Nh·∫≠p h·ªç v√† t√™n'}
                value={inForAdmin.name}
                onFocus={() => handleFocus('name')}
                onChange={(e) => handleChangeInput(e, 'name')}
              />
            )}
            {errorCreateOrUpdate && errorCreateOrUpdate?.name?.length > 0 ? (
              <span className={'error'}>
                <div className={'icon'}>
                  <InlineSVG src={IconWarning} width={14} height="auto" />
                </div>
                {errorCreateOrUpdate?.name}
              </span>
            ) : (
              ''
            )}
          </div>

          <div className={`input-wrap`}>
            <div className={'label-wrap'}>
              Email <span className={'required'}>*</span>
            </div>
            {!isTypeModalCreate && isLoadingDetailUser ? (
              <Skeleton.Input size={'large'} active={true} block={true} />
            ) : (
              <Input
                className={`main-input`}
                placeholder={'Nh·∫≠p email'}
                value={inForAdmin.email}
                onFocus={() => handleFocus('email')}
                onChange={(e) => handleChangeInput(e, 'email')}
              />
            )}
            {errorCreateOrUpdate && errorCreateOrUpdate?.email?.length > 0 ? (
              <span className={'error'}>
                <div className={'icon'}>
                  <InlineSVG src={IconWarning} width={14} height="auto" />
                </div>
                {errorCreateOrUpdate?.email}
              </span>
            ) : (
              ''
            )}
          </div>

          <div className={`input-wrap`}>
            <div className={'label-wrap'}>S·ªë ƒëi·ªán tho·∫°i</div>
            {!isTypeModalCreate && isLoadingDetailUser ? (
              <Skeleton.Input size={'large'} active={true} block={true} />
            ) : (
              <Input
                className={`main-input`}
                placeholder={'Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i'}
                value={inForAdmin.phone}
                onFocus={() => handleFocus('phone')}
                onChange={(e) => handleChangeInput(e, 'phone')}
              />
            )}
            {errorCreateOrUpdate && errorCreateOrUpdate?.phone?.length > 0 ? (
              <span className={'error'}>
                <div className={'icon'}>
                  <InlineSVG src={IconWarning} width={14} height="auto" />
                </div>
                {errorCreateOrUpdate?.phone}
              </span>
            ) : (
              ''
            )}
          </div>

          <div className={`input-wrap`}>
            <div className={'label-wrap'}>ƒê·ªãa ch·ªâ</div>
            <Input
              className={`main-input`}
              placeholder={'Nh·∫≠p ƒë·ªãa ch·ªâ'}
              value={inForAdmin.address}
              onFocus={() => handleFocus('address')}
              onChange={(e) => handleChangeInput(e, 'address')}
            />
            {errorCreateOrUpdate && errorCreateOrUpdate?.address?.length > 0 ? (
              <span className={'error'}>
                <div className={'icon'}>
                  <InlineSVG src={IconWarning} width={14} height="auto" />
                </div>
                {errorCreateOrUpdate?.address}
              </span>
            ) : (
              ''
            )}
          </div>

          <div className={`input-wrap`}>
            <div className={'label-wrap'}>Gi·ªõi t√≠nh <span className={'required'}>*</span></div>

            <Radio.Group onChange={(e) => handleChangeInput(e, 'gender')} value={inForAdmin.gender}>
              <Space>
                <Radio value={GENDER_USER.MALE}>Nam</Radio>
                <Radio value={GENDER_USER.FEMALE}>N·ªØ</Radio>
                <Radio value={GENDER_USER.OTHER}>Kh√°c</Radio>
              </Space>
            </Radio.Group>
            {errorCreateOrUpdate && errorCreateOrUpdate?.gender?.length > 0 ? (
              <span className={'error'}>
                <div className={'icon'}>
                  <InlineSVG src={IconWarning} width={14} height="auto" />
                </div>
                {errorCreateOrUpdate?.gender}
              </span>
            ) : (
              ''
            )}
          </div>

          {configModalAdmin.type === TYPE_SUBMIT.CREATE ? (
            <div className={`input-wrap`}>
              <div className={'label-wrap'}>
                M·∫≠t kh·∫©u <span className={'required'}>*</span>
              </div>
              <Input.Password
                className={`main-input`}
                placeholder={'Nh·∫≠p m·∫≠t kh·∫©u'}
                value={inForAdmin.password}
                onFocus={() => handleFocus('password')}
                onChange={(e) => handleChangeInput(e, 'password')}
              />
              {errorCreateOrUpdate && errorCreateOrUpdate?.password?.length > 0 ? (
                <span className={'error'}>
                  <div className={'icon'}>
                    <InlineSVG src={IconWarning} width={14} height="auto" />
                  </div>
                  {errorCreateOrUpdate?.password}
                </span>
              ) : (
                ''
              )}
            </div>
          ) : (
            ''
          )}

          {hasPermission([PERMISSIONS.EDIT.EDIT_EMPLOYEE_ROLE]) && (
            <div className={`input-wrap`}>
              <div className={'label-wrap'}>Vai tr√≤ </div>
              <TreeSelect
                multiple
                allowClear
                treeDefaultExpandAll
                showSearch={false}
                className="main-select w-full tree_select_wrap"
                placeholder="Ch·ªçn vai tr√≤ "
                notFoundContent={
                  <div className="mt-4 mb-4">
                    <NoData description={'Kh√¥ng c√≥ d·ªØ li·ªáu !'} />
                  </div>
                }
                treeData={treeDataOption}
                value={inForAdmin?.role_ids}
                onChange={(value) => handleChangeInput(value, 'role_ids')}
              />
            </div>
          )}

          <div className={`input-wrap !mb-[15px]`}>
            <div className={'label-wrap'}>
              Tr·∫°ng th√°i <span className={'required'}>*</span>
            </div>
            {!isTypeModalCreate && isLoadingDetailUser ? (
              <Skeleton.Button shape={'round'} size={'large'} active={true} />
            ) : (
              <Switch
                className={`main-switch`}
                checked={inForAdmin.status}
                onChange={(e) => handleChangeSwitch(e, 'status')}
              />
            )}
            {errorCreateOrUpdate && errorCreateOrUpdate?.status?.length > 0 ? (
              <span className={'error'}>
                <div className={'icon'}>
                  <InlineSVG src={IconWarning} width={14} height="auto" />
                </div>
                {errorCreateOrUpdate?.status}
              </span>
            ) : (
              ''
            )}
          </div>
        </div>
      </div>
      <div className={`flex justify-center`}>
        {configModalAdmin.type === TYPE_SUBMIT.CREATE ? (
          <Button
            className={`main-btn-primary`}
            size={'large'}
            loading={isLoadingBtnCreateOrUpdate}
            onClick={() => handleConfirm(TYPE_SUBMIT.CREATE, inForAdmin)}
          >
            T·∫°o m·ªõi
          </Button>
        ) : (
          <Button
            className={`main-btn-primary`}
            size={'large'}
            loading={isLoadingBtnCreateOrUpdate}
            onClick={() => handleConfirm(TYPE_SUBMIT.UPDATE, inForAdmin)}
          >
            C·∫≠p nh·∫≠t
          </Button>
        )}
      </div>
    </div>
  );
}
